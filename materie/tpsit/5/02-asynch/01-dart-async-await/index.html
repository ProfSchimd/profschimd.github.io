<!doctype html><html><head><meta charset=utf-8><title>Dart async e await &ndash; Michele Schimd</title><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/spacelab/bootstrap.min.css rel=stylesheet><link href=https://profschimd.github.io/css/syntax.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css><script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body class="d-flex flex-column min-vh-100"><header><nav class="p-1 navbar navbar-expand-lg navbar-dark bg-primary"><div class=container><a class=navbar-brand rel=author href=https://profschimd.github.io/>Michele Schimd</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>Materie</a><ul class=dropdown-menu aria-labelledby=navbarDropdown><li><a href=https://profschimd.github.io/materie/inf/ class=dropdown-item>Informatica</a></li><li><a href=https://profschimd.github.io/materie/sr/ class=dropdown-item>SR</a></li><li><a href=https://profschimd.github.io/materie/tpsit/ class=dropdown-item>TPSIT</a></li><li><a href=https://profschimd.github.io/materie/gpoi/ class=dropdown-item>GPOI</a></li><li><a href=https://profschimd.github.io/materie/ec/ class=dropdown-item>EC</a></li><li><a href=https://profschimd.github.io/materie/python/ class=dropdown-item>Python</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-expanded=false>Classi</a><ul class=dropdown-menu aria-labelledby=navbarDropdown><li><a href=https://profschimd.github.io/classi/4ia/ class=dropdown-item>4IA</a></li><li><a href=https://profschimd.github.io/classi/4ic/ class=dropdown-item>4IC</a></li><li><a href=https://profschimd.github.io/classi/5ic/ class=dropdown-item>5IC</a></li><li><a href=https://profschimd.github.io/classi/5id/ class=dropdown-item>5ID</a></li><li><a href=https://profschimd.github.io/classi/anni-passati/ class=dropdown-item>Anni precedenti</a></li></ul></li><li class=nav-item><a class=nav-link href=https://profschimd.github.io/about/ role=button><i class="bi bi-info-circle"></i></a></li></ul></div></div></nav></header><div class="p-4 bg-primary" style="background-size:cover;background-position:50%;background-image:linear-gradient(to bottom,rgba(0,0,0,.3) 0%,rgba(0,0,0,.6) 100%),url(https://profschimd.github.io/img/zuccante_it.jpeg)"><div class=container><h1 class="display-4 text-white">Dart async e await</h1></div></div><div class=bg-light><nav aria-label="breadcrumb mt-0"><div class=container><ol class=breadcrumb><li class=breadcrumb-item><a href=https://profschimd.github.io/>Home</a></li><li class=breadcrumb-item><a href=https://profschimd.github.io/materie/>Materie</a></li><li class=breadcrumb-item><a href=https://profschimd.github.io/materie/tpsit/>TPSIT</a></li><li class=breadcrumb-item><a href=https://profschimd.github.io/materie/tpsit/5/>Quinto Anno</a></li><li class=breadcrumb-item><a href=https://profschimd.github.io/materie/tpsit/5/02-asynch/>Programmazione asincrona in Dart</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://profschimd.github.io/materie/tpsit/5/02-asynch/01-dart-async-await/>Dart async e await</a></li></ol></nav></div><div class="container py-5"><main><div class=row><div class=col-10><aside><nav id=TableOfContents><ul><li><a href=#programmazione-asincrona>Programmazione asincrona</a></li><li><a href=#la-programmazione-asincrona-in-dart>La programmazione asincrona in Dart</a><ul><li><a href=#future><code>Future</code></a></li><li><a href=#async-e-await><code>async</code> e <code>await</code></a></li><li><a href=#stream>Stream</a></li></ul></li></ul></nav></aside></div><div class=col-2></div></div><article><div class=container style=text-align:justify><h2 id=programmazione-asincrona>Programmazione asincrona</h2><p>La <em>programmazione asincrona</em> è una tecnica di programmazione che permette di eseguire alcune
operazione in modo &ldquo;scollegato&rdquo; (asincrono, per l&rsquo;appunto) rispetto al normale flusso delle
istruzioni (ad esempio, rispetto al <code>main</code>). La programmazione asincrona permette, quindi, di
eseguire alcune operazione (ad esempio quelle che richiedono più tempo) senza interrompere il
programma principale. Questa tecnica viene usata spesso nella programmazione di interfacce
grafiche in quanto alcune operazioni lunghe (ad esempio scaricare immagini, video, &mldr;)
bloccherebbero l&rsquo;interfaccia se non fossero eseguite in <em>background</em>. Utilizzando la programmazione
asincrona, queste operazioni vengono eseguite in modo asincrono rispetto alla gestione della
GUI lasciando questa pienamente funzionante e <em>responsiva</em>.</p><p>La programmazione asincrona è possibile grazie ai <em>thread</em> che permettono l&rsquo;esecuzione
parallela di flussi di codice diversi. Normalmente, tuttavia, in fase di programmazione
asincrona non viene direttamente gestito il <em>ciclo di vita</em> (creazione, avvio, fermata)
di un thread, bensì si utilizzando i costrutti del linguaggio o le API delle librerie
utilizzate.
Maggiori dettagli sulla programmazione asincrona, con esempi in Java, si possono trovare
in <a href=https://profschimd.github.io/materie/tpsit/4/05-multi-threading/programmazione_asincrona/>questa lezione</a>.</p><h2 id=la-programmazione-asincrona-in-dart>La programmazione asincrona in Dart</h2><p>Il linguaggio Dart comprende costrutti per la gestione della programmazione, i principali
sono <code>async</code> e <code>await</code> (con la variante <code>await for</code>) ai quali vanno aggiunti i <code>Future</code> e
gli <code>Stream</code>.</p><h3 id=future><code>Future</code></h3><p>Un concetto fondamentale in Dart (e in generale nella programmazione asincrona) è quello di
<em>future</em> che è una &ldquo;promessa di risultato in futuro&rdquo;. In pratica quando una funzione o un
metodo viene chiamato, ma ancora non ha il risultato pronto, può restituire un <code>Future</code>
(attenzione alla <code>F</code> maiuscola) per indicare che in futuro il risultato sarà disponibile.</p><p>In Dart la classe <code>Future</code> rappresenta una <em>computazione</em> ed assomiglia un po&rsquo; al concetto
di <em>thread</em> ed alla classe <code>Thread</code> di Java, tuttavia ci sono delle differenze.</p><h4 id=creazione-di-un-future>Creazione di un <code>Future</code></h4><p>Ci sono diversi <a href=https://api.dart.dev/be/175791/dart-async/Future-class.html#constructors target=_blank rel=noopener>costruttori per la classe <code>Future</code></a>,
i più importanti sono elencati qui sotto.</p><ul><li><code>Future(&lt;computation>)</code>: crea una computazione asincrona, il parametro può essere
una funziona o a sua volta un <code>Future</code></li><li><code>Future.delayed(Duration d, &lt;computation>)</code> crea una computazione asincrona con partenza ritardata
della durata <code>d</code>, il secondo parametro può essere una funziona o a sua volta un <code>Future</code></li><li><code>Future.sync(&lt;computation>)</code>: crea una computazione sincrona (eseguita immediatamente), il parametro può essere
una funziona o a sua volta un <code>Future</code>.</li></ul><p>L&rsquo;esempio seguente mostra l&rsquo;utilizzo dei costruttori descritti sopra</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Future</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Unnamed ctr.&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=n>Future</span><span class=p>.</span><span class=n>delayed</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kd>const</span> <span class=n>Duration</span><span class=p>(</span><span class=nl>seconds:</span> <span class=m>2</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=o>=&gt;</span> <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Delayed ctr. (2 sec)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>Future</span><span class=p>.</span><span class=kd>sync</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Sync ctr.&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>l&rsquo;output prodotto sarà</p><pre><code>Sync ctr.
Unnamed ctr.
Delayed ctr. (2 sec)
</code></pre><p>notare come l&rsquo;ultima riga corrisponda al secondo costruttore, questo, infatti ha un ritardi di 2 secondi
nell&rsquo;avvio, di conseguenza il suo output si trova dopo gli altri due computazioni (costruttori <em>unnamed</em>
e <em>sync</em>) che invece vengono avviati immediatamente dopo la creazione.</p><p>L&rsquo;utilizzo fatto fin qui dei <code>Future</code> non assomiglia molto all&rsquo;utilizzo di una funzione, infatti qualsiasi
valore ritornato non sarebbe utilizzabile (nell&rsquo;esempio, tuttavia, non ci sono valori ritornati).
Consideriamo il seguente esempio</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;</span> <span class=n>someLongComputation</span><span class=p>()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>Future</span><span class=p>.</span><span class=n>delayed</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kd>const</span> <span class=n>Duration</span><span class=p>(</span><span class=nl>seconds:</span> <span class=m>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=o>=&gt;</span> <span class=s1>&#39;Finally the DATA!&#39;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=n>someLongComputation</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Vediamo insieme cosa accade:</p><ul><li>il <code>main</code> chiama la funzione <code>someLongComputation</code>,</li><li>questa funzione restituisce un <code>Future</code> la cui computazione produce una stringa (<code>Finally the DATA!</code>),</li><li>come si evince anche dalla firma della funzione, l&rsquo;oggetto stampato sarà un&rsquo;istanza di <code>Future</code>.</li></ul><p>Le operazioni scritte sono abbastanza ovvie a chi ha esperienza con la programmazione, tuttavia nella
programmazione asincrona vorremmo avere un meccanismo che stampi, nell&rsquo;esempio, la stringa ottenuta una
volta terminata la computazione del <code>Future</code>. Il modo per ottenere questo risultato in Dart è spiegato
nel prossimo paragrafo.</p><h3 id=async-e-await><code>async</code> e <code>await</code></h3><p>Quando il risultato di una funzione è un <code>Future</code> spesso l&rsquo;output che si vuole non l&rsquo;oggetto <code>Future</code>
stesso, bensì il risultato della sua computazione. Nell&rsquo;esempio sopra, il risultato è una stringa la
quale sarà disponibile dopo un po&rsquo; di tempo (simulato con <code>Factory.delayed</code> nell&rsquo;esempio), in altre
parole vorremmo che <em>il <code>main</code> attendesse il termine della computazione del <code>Future</code> por poi stampare
il risultato di questa stessa computazione</em>. In Dart qualche piccola modifica permette di ottenere tale
risultato</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=kt>String</span><span class=o>&gt;</span> <span class=n>someLongComputation</span><span class=p>()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=n>Future</span><span class=p>.</span><span class=n>delayed</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=kd>const</span> <span class=n>Duration</span><span class=p>(</span><span class=nl>seconds:</span> <span class=m>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>()</span> <span class=o>=&gt;</span> <span class=s1>&#39;Finally the DATA!&#39;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=kd>await</span> <span class=n>someLongComputation</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Il codice è identico al precedente ad eccezione del <code>main</code> dove notiamo</p><ul><li>l&rsquo;utilizzo di <code>await</code> prima della chiamata alla funzione <code>someLongComputation</code>,</li><li>l&rsquo;utilizzo di <code>async</code> prima dell&rsquo;inizio del corpo del <code>main</code>.</li></ul><p>La prima modifica, l&rsquo;uso di <code>await</code> comunica a Dart che la chiamata che segue è ad una funziona
asincrona (ritorna un <code>Future</code>) e che ciò che si vuole è aspettare il risultato. La seconda
modifica, l&rsquo;uso di <code>async</code>, è necessario per comunicare a Dart che la funzione <code>main</code> utilizzerà
<code>await</code> (o <code>await for</code>) ed è perciò essa stessa una funzione asincrona.</p><div class="alert alert-danger" markdown=1><h5 class="alert-danger no_toc"><i class="bi bi-exclamation-triangle"></i> Attenzione</strong></h5><p>È molto facile dimenticarsi di dichiarare una funzione senza <code>async</code> e poi utilizzare <code>await</code> nel
corpo della funzione, in questo caso il compilatore Dart segnala un errore. Fortunatamente la
correzione di questo errore, l&rsquo;aggiunga di <code>async</code>, è immediata.</p></div><h3 id=stream>Stream</h3><h1 id=link-utili>Link utili</h1><ul><li><a href=https://dart.dev/guides/language/language-tour#asynchrony-support target=_blank rel=noopener>Tour del linguaggio Dart (programmazione asincrona)</a></li><li><a href=https://dart.dev/codelabs/async-await target=_blank rel=noopener>Asynchronous programming Dart codelabs</a></li></ul></div></article><nav class="mx-5 my-3"><div class=card><h5 class=card-header>Indice di Programmazione asincrona in Dart</h5><ul class="list-group list-group-flush"><li class="list-group-item list-group-item-primary"><strong><a href=https://profschimd.github.io/materie/tpsit/5/02-asynch/01-dart-async-await/>> Dart async e await</a></strong></li><li class=list-group-item><a href=https://profschimd.github.io/materie/tpsit/5/02-asynch/02-stream-dart/>Dart stream</a></li><li class=list-group-item><a href=https://profschimd.github.io/materie/tpsit/5/02-asynch/l01-async-http/>Laboratorio: richiesta HTTP con async</a></li></ul><div class=card-footer><a class="btn btn-primary" href=https://profschimd.github.io/materie/tpsit/5/02-asynch/>Index</a></div></div></nav></main></div><div class="py-3 border-top bg-light mt-auto"><div class=container><div class=row><div class=col-sm><ul class=list-unstyled><li>Michele Schimd &copy; 2022</li><li><a class=pr-1 href=mailto:michele.schimd@itiszuccante.edu.it><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" fill="currentcolor" class="bi bi-at" viewBox="0 0 16 16"><path d="M.05 3.555A2 2 0 012 2h12a2 2 0 011.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83.191 12.857A2 2 0 002 14h12a2 2 0 001.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"/></svg></a><a class=pr-1 rel=me href=https://github.com/ProfSchimd target=_blank title=ProfSchimd alt=GitHub><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" fill="currentcolor" class="bi bi-github" viewBox="0 0 16 16"><path d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.012 8.012.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><a class=pr-1 rel=me href=https://www.linkedin.com/in/michele-schimd-44a85160 target=_blank title=michele-schimd-44a85160 alt=Linkedin><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" fill="currentcolor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822.0-1.359.54-1.359 1.248.0.694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54.0 01.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225h2.4z"/></svg></a><a class=pr-1 rel=me href=https://stackoverflow.com/users/18081937 target=_blank title=18081937><svg xmlns="http://www.w3.org/2000/svg" width="1.5em" fill="currentcolor" class="bi bi-stack-overflow" viewBox="0 0 16 16"><path d="M12.412 14.572V10.29h1.428V16H1v-5.71h1.428v4.282h9.984z"/><path d="M3.857 13.145h7.137v-1.428H3.857v1.428zM10.254.0 9.108.852l4.26 5.727 1.146-.852L10.254.0zm-3.54 3.377 5.484 4.567.913-1.097L7.627 2.28l-.914 1.097zM4.922 6.55l6.47 3.013.603-1.294-6.47-3.013-.603 1.294zm-.925 3.344 6.985 1.469.294-1.398-6.985-1.468-.294 1.397z"/></svg></a></li><li><span style=font-size:small><em>Ultimo aggiornamento: 22/12/2022</em></span></li></ul></div><div class="col-lg text-right"><ul class=list-unstyled><li>Materiale di studio e di esercizio per gli alunni dello Zuccante.</li></ul><div><p><a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img style=float:right alt="Creative Commons License" src=https://i.creativecommons.org/l/by-nc/4.0/88x31.png></a></div></p></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js integrity=sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js integrity=sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF crossorigin=anonymous></script></body></html>